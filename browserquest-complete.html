<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>BrowserQuest - Complete Single Player</title>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
            color: white;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #parchment {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border: 4px solid #654321;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            color: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        #parchment h1 {
            margin-top: 0;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        #nameinput {
            width: 250px;
            padding: 12px;
            margin: 15px;
            border: 2px solid #654321;
            border-radius: 8px;
            background: #f4e4bc;
            font-size: 16px;
        }
        
        .play {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 15px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .play:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
        }
        
        .play.disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        #bar-container {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 50px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            border: 2px solid #333;
        }
        
        #healthbar {
            width: 200px;
            height: 25px;
            background: #333;
            border: 2px solid #666;
            border-radius: 12px;
            margin-right: 20px;
            overflow: hidden;
        }
        
        #hitpoints {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.3s;
            min-width: 0;
        }
        
        #playerinfo {
            display: flex;
            flex-direction: column;
            font-size: 12px;
        }
        
        #chatbox {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 35px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            display: none;
            border: 2px solid #333;
        }
        
        #chatinput {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            color: white;
            padding: 0 15px;
            outline: none;
            font-size: 14px;
        }
        
        #inventory {
            position: absolute;
            top: 70px;
            right: 10px;
            width: 200px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #333;
            display: none;
        }
        
        .inventory-item {
            background: #333;
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .inventory-item:hover {
            background: #555;
        }
        
        #achievements {
            position: absolute;
            top: 70px;
            left: 10px;
            width: 250px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #333;
            display: none;
        }
        
        .achievement {
            background: #333;
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            border-left: 4px solid #FFD700;
        }
        
        .achievement.unlocked {
            border-left-color: #4CAF50;
        }
        
        .hidden {
            display: none !important;
        }
        
        #controls {
            position: absolute;
            bottom: 60px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #333;
            font-size: 12px;
        }
        
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #FFD700;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            font-size: 18px;
            font-weight: bold;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body>
    <div id="intro">
        <div id="parchment">
            <h1>üó°Ô∏è BrowserQuest üõ°Ô∏è</h1>
            <h2>Single Player Adventure</h2>
            <p>Enter your character name:</p>
            <input type="text" id="nameinput" placeholder="Character name" maxlength="15">
            <br>
            <button class="play" id="playbutton">Start Adventure</button>
            <br>
            <small>All progress is saved automatically!</small>
        </div>
    </div>
    
    <div id="container" class="hidden">
        <div id="canvas">
            <canvas id="background"></canvas>
            <canvas id="entities"></canvas>
            <canvas id="foreground"></canvas>
        </div>
        
        <div id="bar-container">
            <div id="healthbar">
                <div id="hitpoints"></div>
            </div>
            <div id="playerinfo">
                <div>Health: <span id="health-text">100/100</span></div>
                <div>Level: <span id="level-text">1</span> | Gold: <span id="gold-text">0</span></div>
            </div>
        </div>
        
        <div id="chatbox">
            <input type="text" id="chatinput" placeholder="Type a message...">
        </div>
        
        <div id="inventory">
            <h3>Inventory</h3>
            <div id="inventory-items"></div>
        </div>
        
        <div id="achievements">
            <h3>Achievements</h3>
            <div id="achievement-list"></div>
        </div>
        
        <div id="controls">
            <strong>Controls:</strong><br>
            WASD/Arrows: Move<br>
            Enter: Chat<br>
            I: Inventory<br>
            A: Achievements<br>
            Space: Attack
        </div>
        
        <div id="notification" class="notification"></div>
    </div>

    <script>
        // Complete single-player BrowserQuest implementation
        
        // Game state
        let gameState = {
            player: {
                name: '',
                x: 8,
                y: 8,
                health: 100,
                maxHealth: 100,
                level: 1,
                experience: 0,
                gold: 0,
                inventory: [],
                achievements: [],
                kills: 0,
                damage: 0
            },
            entities: {},
            mobs: [],
            items: [],
            map: null,
            isRunning: false,
            lastUpdate: Date.now(),
            entityIdCounter: 1
        };
        
        // Entity types
        const ENTITY_TYPES = {
            PLAYER: 1,
            RAT: 2,
            SKELETON: 3,
            GOBLIN: 4,
            SWORD: 60,
            ARMOR: 21,
            POTION: 35
        };
        
        // Canvas setup
        const canvas = document.getElementById('entities');
        const ctx = canvas.getContext('2d');
        const backgroundCanvas = document.getElementById('background');
        const bgCtx = backgroundCanvas.getContext('2d');
        const foregroundCanvas = document.getElementById('foreground');
        const fgCtx = foregroundCanvas.getContext('2d');
        
        // Resize canvas
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight);
            canvas.width = size;
            canvas.height = size;
            backgroundCanvas.width = size;
            backgroundCanvas.height = size;
            foregroundCanvas.width = size;
            foregroundCanvas.height = size;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Enhanced map data (32x32 tiles)
        const mapData = {
            width: 32,
            height: 32,
            tiles: generateMap()
        };
        
        function generateMap() {
            const tiles = [];
            for (let y = 0; y < 32; y++) {
                tiles[y] = [];
                for (let x = 0; x < 32; x++) {
                    // Border walls
                    if (x === 0 || x === 31 || y === 0 || y === 31) {
                        tiles[y][x] = 1;
                    }
                    // Random walls inside
                    else if (Math.random() < 0.1) {
                        tiles[y][x] = 1;
                    }
                    // Open space
                    else {
                        tiles[y][x] = 0;
                    }
                }
            }
            return tiles;
        }
        
        // Tile size
        const TILE_SIZE = 16;
        
        // Render map
        function renderMap() {
            bgCtx.fillStyle = '#2d5016'; // Grass color
            bgCtx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let y = 0; y < mapData.height; y++) {
                for (let x = 0; x < mapData.width; x++) {
                    if (mapData.tiles[y][x] === 1) {
                        bgCtx.fillStyle = '#8B4513'; // Wall color
                        bgCtx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    }
                }
            }
        }
        
        // Create mob
        function createMob(type, x, y) {
            const mob = {
                id: gameState.entityIdCounter++,
                type: type,
                x: x,
                y: y,
                health: getMobHealth(type),
                maxHealth: getMobHealth(type),
                damage: getMobDamage(type),
                lastAttack: 0,
                target: null,
                lastMove: 0
            };
            gameState.mobs.push(mob);
            return mob;
        }
        
        function getMobHealth(type) {
            switch(type) {
                case ENTITY_TYPES.RAT: return 20;
                case ENTITY_TYPES.SKELETON: return 40;
                case ENTITY_TYPES.GOBLIN: return 60;
                default: return 30;
            }
        }
        
        function getMobDamage(type) {
            switch(type) {
                case ENTITY_TYPES.RAT: return 5;
                case ENTITY_TYPES.SKELETON: return 10;
                case ENTITY_TYPES.GOBLIN: return 15;
                default: return 8;
            }
        }
        
        // Create item
        function createItem(type, x, y) {
            const item = {
                id: gameState.entityIdCounter++,
                type: type,
                x: x,
                y: y,
                name: getItemName(type)
            };
            gameState.items.push(item);
            return item;
        }
        
        function getItemName(type) {
            switch(type) {
                case ENTITY_TYPES.SWORD: return 'Iron Sword';
                case ENTITY_TYPES.ARMOR: return 'Leather Armor';
                case ENTITY_TYPES.POTION: return 'Health Potion';
                default: return 'Unknown Item';
            }
        }
        
        // Spawn initial entities
        function spawnInitialEntities() {
            // Spawn some mobs
            for (let i = 0; i < 10; i++) {
                const x = Math.floor(Math.random() * 30) + 1;
                const y = Math.floor(Math.random() * 30) + 1;
                if (mapData.tiles[y][x] === 0) {
                    const types = [ENTITY_TYPES.RAT, ENTITY_TYPES.SKELETON, ENTITY_TYPES.GOBLIN];
                    const type = types[Math.floor(Math.random() * types.length)];
                    createMob(type, x, y);
                }
            }
            
            // Spawn some items
            for (let i = 0; i < 5; i++) {
                const x = Math.floor(Math.random() * 30) + 1;
                const y = Math.floor(Math.random() * 30) + 1;
                if (mapData.tiles[y][x] === 0) {
                    const types = [ENTITY_TYPES.SWORD, ENTITY_TYPES.ARMOR, ENTITY_TYPES.POTION];
                    const type = types[Math.floor(Math.random() * types.length)];
                    createItem(type, x, y);
                }
            }
        }
        
        // Render player
        function renderPlayer() {
            ctx.fillStyle = '#4169E1'; // Blue player
            ctx.fillRect(
                gameState.player.x * TILE_SIZE + 2,
                gameState.player.y * TILE_SIZE + 2,
                TILE_SIZE - 4,
                TILE_SIZE - 4
            );
            
            // Player name
            ctx.fillStyle = '#fff';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(
                gameState.player.name,
                gameState.player.x * TILE_SIZE + TILE_SIZE / 2,
                gameState.player.y * TILE_SIZE - 2
            );
        }
        
        // Render mobs
        function renderMobs() {
            gameState.mobs.forEach(mob => {
                if (mob.health <= 0) return;
                
                let color = '#666';
                switch(mob.type) {
                    case ENTITY_TYPES.RAT: color = '#8B4513'; break;
                    case ENTITY_TYPES.SKELETON: color = '#C0C0C0'; break;
                    case ENTITY_TYPES.GOBLIN: color = '#228B22'; break;
                }
                
                ctx.fillStyle = color;
                ctx.fillRect(
                    mob.x * TILE_SIZE + 1,
                    mob.y * TILE_SIZE + 1,
                    TILE_SIZE - 2,
                    TILE_SIZE - 2
                );
                
                // Health bar
                const healthPercent = mob.health / mob.maxHealth;
                ctx.fillStyle = '#333';
                ctx.fillRect(mob.x * TILE_SIZE, mob.y * TILE_SIZE - 4, TILE_SIZE, 2);
                ctx.fillStyle = healthPercent > 0.5 ? '#4CAF50' : healthPercent > 0.25 ? '#FFC107' : '#F44336';
                ctx.fillRect(mob.x * TILE_SIZE, mob.y * TILE_SIZE - 4, TILE_SIZE * healthPercent, 2);
            });
        }
        
        // Render items
        function renderItems() {
            gameState.items.forEach(item => {
                let color = '#FFD700';
                switch(item.type) {
                    case ENTITY_TYPES.SWORD: color = '#C0C0C0'; break;
                    case ENTITY_TYPES.ARMOR: color = '#8B4513'; break;
                    case ENTITY_TYPES.POTION: color = '#FF6B6B'; break;
                }
                
                ctx.fillStyle = color;
                ctx.fillRect(
                    item.x * TILE_SIZE + 4,
                    item.y * TILE_SIZE + 4,
                    TILE_SIZE - 8,
                    TILE_SIZE - 8
                );
            });
        }
        
        // Render entities
        function renderEntities() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            renderPlayer();
            renderMobs();
            renderItems();
        }
        
        // Mob AI
        function updateMobs() {
            const now = Date.now();
            
            gameState.mobs.forEach(mob => {
                if (mob.health <= 0) return;
                
                // Simple AI: move towards player if close
                const distance = Math.abs(mob.x - gameState.player.x) + Math.abs(mob.y - gameState.player.y);
                
                if (distance <= 3 && now - mob.lastMove > 1000) {
                    // Move towards player
                    let dx = 0, dy = 0;
                    if (mob.x < gameState.player.x) dx = 1;
                    else if (mob.x > gameState.player.x) dx = -1;
                    if (mob.y < gameState.player.y) dy = 1;
                    else if (mob.y > gameState.player.y) dy = -1;
                    
                    const newX = mob.x + dx;
                    const newY = mob.y + dy;
                    
                    if (newX >= 0 && newX < mapData.width && newY >= 0 && newY < mapData.height &&
                        mapData.tiles[newY][newX] === 0) {
                        mob.x = newX;
                        mob.y = newY;
                        mob.lastMove = now;
                    }
                }
                
                // Attack player if adjacent
                if (distance === 1 && now - mob.lastAttack > 2000) {
                    attackPlayer(mob);
                    mob.lastAttack = now;
                }
            });
        }
        
        // Attack player
        function attackPlayer(mob) {
            const damage = mob.damage;
            gameState.player.health -= damage;
            gameState.player.damage += damage;
            
            showNotification(`You take ${damage} damage!`);
            
            if (gameState.player.health <= 0) {
                gameState.player.health = 0;
                showNotification('You died! Respawning...');
                setTimeout(() => {
                    gameState.player.health = gameState.player.maxHealth;
                    gameState.player.x = 8;
                    gameState.player.y = 8;
                }, 2000);
            }
            
            updateUI();
        }
        
        // Attack mob
        function attackMob(mob) {
            const damage = 20; // Player damage
            mob.health -= damage;
            
            showNotification(`You deal ${damage} damage!`);
            
            if (mob.health <= 0) {
                gameState.player.kills++;
                gameState.player.experience += 10;
                showNotification(`You killed the ${getMobName(mob.type)}! +10 XP`);
                
                // Check for level up
                if (gameState.player.experience >= gameState.player.level * 100) {
                    gameState.player.level++;
                    gameState.player.maxHealth += 20;
                    gameState.player.health = gameState.player.maxHealth;
                    showNotification(`Level up! You are now level ${gameState.player.level}!`);
                }
                
                // Drop item sometimes
                if (Math.random() < 0.3) {
                    const types = [ENTITY_TYPES.POTION, ENTITY_TYPES.SWORD, ENTITY_TYPES.ARMOR];
                    const type = types[Math.floor(Math.random() * types.length)];
                    createItem(type, mob.x, mob.y);
                }
                
                // Remove mob
                const index = gameState.mobs.indexOf(mob);
                if (index > -1) {
                    gameState.mobs.splice(index, 1);
                }
            }
            
            updateUI();
            checkAchievements();
        }
        
        function getMobName(type) {
            switch(type) {
                case ENTITY_TYPES.RAT: return 'Rat';
                case ENTITY_TYPES.SKELETON: return 'Skeleton';
                case ENTITY_TYPES.GOBLIN: return 'Goblin';
                default: return 'Monster';
            }
        }
        
        // Pick up item
        function pickupItem(item) {
            gameState.player.inventory.push(item);
            gameState.player.gold += 10; // Bonus gold for finding items
            
            showNotification(`You picked up ${item.name}! +10 gold`);
            
            // Remove item
            const index = gameState.items.indexOf(item);
            if (index > -1) {
                gameState.items.splice(index, 1);
            }
            
            updateUI();
            updateInventory();
        }
        
        // Game loop
        function gameLoop() {
            if (!gameState.isRunning) return;
            
            const now = Date.now();
            const deltaTime = now - gameState.lastUpdate;
            gameState.lastUpdate = now;
            
            // Update game logic
            updateMobs();
            
            // Render
            renderEntities();
            
            requestAnimationFrame(gameLoop);
        }
        
        // Handle player movement
        function movePlayer(dx, dy) {
            const newX = gameState.player.x + dx;
            const newY = gameState.player.y + dy;
            
            // Check bounds
            if (newX >= 0 && newX < mapData.width && newY >= 0 && newY < mapData.height) {
                // Check collision with walls
                if (mapData.tiles[newY][newX] === 0) {
                    gameState.player.x = newX;
                    gameState.player.y = newY;
                    
                    // Check for items to pick up
                    const item = gameState.items.find(i => i.x === newX && i.y === newY);
                    if (item) {
                        pickupItem(item);
                    }
                    
                    // Check for mobs to attack
                    const mob = gameState.mobs.find(m => m.x === newX && m.y === newY && m.health > 0);
                    if (mob) {
                        attackMob(mob);
                    }
                }
            }
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }
        
        // Update UI
        function updateUI() {
            document.getElementById('health-text').textContent = 
                `${gameState.player.health}/${gameState.player.maxHealth}`;
            document.getElementById('level-text').textContent = gameState.player.level;
            document.getElementById('gold-text').textContent = gameState.player.gold;
            
            const healthPercent = (gameState.player.health / gameState.player.maxHealth) * 100;
            document.getElementById('hitpoints').style.width = healthPercent + '%';
        }
        
        // Update inventory
        function updateInventory() {
            const container = document.getElementById('inventory-items');
            container.innerHTML = '';
            
            gameState.player.inventory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'inventory-item';
                div.textContent = item.name;
                div.onclick = () => useItem(item, index);
                container.appendChild(div);
            });
        }
        
        // Use item
        function useItem(item, index) {
            switch(item.type) {
                case ENTITY_TYPES.POTION:
                    gameState.player.health = Math.min(gameState.player.maxHealth, gameState.player.health + 50);
                    showNotification('You used a health potion!');
                    break;
                case ENTITY_TYPES.SWORD:
                    showNotification('You equipped the sword!');
                    break;
                case ENTITY_TYPES.ARMOR:
                    showNotification('You equipped the armor!');
                    break;
            }
            
            gameState.player.inventory.splice(index, 1);
            updateInventory();
            updateUI();
        }
        
        // Check achievements
        function checkAchievements() {
            const achievements = [
                { id: 'first_kill', name: 'First Blood', desc: 'Kill your first monster', condition: () => gameState.player.kills >= 1 },
                { id: 'level_5', name: 'Experienced', desc: 'Reach level 5', condition: () => gameState.player.level >= 5 },
                { id: 'rich', name: 'Rich', desc: 'Collect 100 gold', condition: () => gameState.player.gold >= 100 },
                { id: 'survivor', name: 'Survivor', desc: 'Take 500 damage', condition: () => gameState.player.damage >= 500 }
            ];
            
            achievements.forEach(achievement => {
                if (!gameState.player.achievements.includes(achievement.id) && achievement.condition()) {
                    gameState.player.achievements.push(achievement.id);
                    showNotification(`Achievement unlocked: ${achievement.name}!`);
                    updateAchievements();
                }
            });
        }
        
        // Update achievements display
        function updateAchievements() {
            const container = document.getElementById('achievement-list');
            container.innerHTML = '';
            
            const achievements = [
                { id: 'first_kill', name: 'First Blood', desc: 'Kill your first monster' },
                { id: 'level_5', name: 'Experienced', desc: 'Reach level 5' },
                { id: 'rich', name: 'Rich', desc: 'Collect 100 gold' },
                { id: 'survivor', name: 'Survivor', desc: 'Take 500 damage' }
            ];
            
            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = `achievement ${gameState.player.achievements.includes(achievement.id) ? 'unlocked' : ''}`;
                div.innerHTML = `<strong>${achievement.name}</strong><br><small>${achievement.desc}</small>`;
                container.appendChild(div);
            });
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameState.isRunning) return;
            
            switch(e.key.toLowerCase()) {
                case 'arrowup':
                case 'w':
                    movePlayer(0, -1);
                    break;
                case 'arrowdown':
                case 's':
                    movePlayer(0, 1);
                    break;
                case 'arrowleft':
                case 'a':
                    movePlayer(-1, 0);
                    break;
                case 'arrowright':
                case 'd':
                    movePlayer(1, 0);
                    break;
                case 'enter':
                    document.getElementById('chatbox').style.display = 'block';
                    document.getElementById('chatinput').focus();
                    break;
                case 'i':
                    const inventory = document.getElementById('inventory');
                    inventory.style.display = inventory.style.display === 'none' ? 'block' : 'none';
                    break;
                case 'a':
                    const achievements = document.getElementById('achievements');
                    achievements.style.display = achievements.style.display === 'none' ? 'block' : 'none';
                    break;
                case ' ':
                    // Attack nearby mobs
                    const nearbyMob = gameState.mobs.find(m => 
                        Math.abs(m.x - gameState.player.x) <= 1 && 
                        Math.abs(m.y - gameState.player.y) <= 1 && 
                        m.health > 0
                    );
                    if (nearbyMob) {
                        attackMob(nearbyMob);
                    }
                    break;
            }
        });
        
        // Chat input
        document.getElementById('chatinput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const message = e.target.value;
                if (message.trim()) {
                    console.log('Chat:', message);
                    e.target.value = '';
                }
                document.getElementById('chatbox').style.display = 'none';
            } else if (e.key === 'Escape') {
                document.getElementById('chatbox').style.display = 'none';
                e.target.value = '';
            }
        });
        
        // Start game
        function startGame() {
            const nameInput = document.getElementById('nameinput');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Please enter a character name!');
                return;
            }
            
            gameState.player.name = name;
            gameState.isRunning = true;
            
            // Hide intro, show game
            document.getElementById('intro').classList.add('hidden');
            document.getElementById('container').classList.remove('hidden');
            
            // Initialize game
            renderMap();
            spawnInitialEntities();
            updateUI();
            updateInventory();
            updateAchievements();
            gameLoop();
            
            showNotification(`Welcome to BrowserQuest, ${name}!`);
        }
        
        // Event listeners
        document.getElementById('playbutton').addEventListener('click', startGame);
        document.getElementById('nameinput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                startGame();
            }
        });
        
        // Local storage for save data
        function saveGame() {
            localStorage.setItem('browserquest-save', JSON.stringify(gameState));
        }
        
        function loadGame() {
            const saveData = localStorage.getItem('browserquest-save');
            if (saveData) {
                const saved = JSON.parse(saveData);
                gameState.player = { ...gameState.player, ...saved.player };
                return true;
            }
            return false;
        }
        
        // Auto-save every 30 seconds
        setInterval(saveGame, 30000);
        
        // Load saved game on start
        if (loadGame()) {
            document.getElementById('nameinput').value = gameState.player.name;
        }
        
        // Handle page unload
        window.addEventListener('beforeunload', saveGame);
        
        console.log('BrowserQuest Complete Single Player loaded!');
        console.log('Controls: WASD/Arrows to move, Space to attack, I for inventory, A for achievements');
    </script>
</body>
</html>